--- radeontool-1.5/radeontool.7.orig	2008-05-01 11:38:37.000000000 +0100
+++ radeontool-1.5/radeontool.7	2008-05-01 11:36:45.000000000 +0100
@@ -0,0 +1,59 @@
+.\" This manpage has been automatically generated by docbook2man 
+.\" from a DocBook document.  This tool can be found at:
+.\" <http://shell.ipoline.com/~elmert/comp/docbook2X/> 
+.\" Please send any bug reports, improvements, comments, patches, 
+.\" etc. to Steve Cheng <steve@ggi-project.org>.
+.TH "RADEONTOOL" "7" "01 May 2008" "" ""
+
+.SH NAME
+radeontool \- utility to control backlight on radeon based laptops
+.SH SYNOPSIS
+
+\fBradeontool\fR [ \fB\fIoption\fB\fR ] [ \fB\fIcommand\fB\fR ]
+
+.SH "DESCRIPTION"
+.PP
+This manual page documents briefly the
+\fBradeontool\fR command.
+.PP
+This manual page was written for the Debian distribution
+because the original program does not have a manual page.
+.PP
+\fBradeontool\fR is a program that switches on/off
+backlight and external output on ATI Radeon based laptops
+.SH "COMMANDS"
+.PP
+You can specify on of the following commands:
+.TP
+\fBdac [on|off] \fR
+Power down the external video output
+.TP
+\fBlight [on|off] \fR
+Power down the backlight
+.TP
+\fBstretch [on|off|vert|horiz|auto|manual] \fR
+Adjusts stretching for resolution mismatch
+.TP
+\fBregs \fR
+Show a listing of some random registers
+.SH "OPTIONS"
+.PP
+These programs follow the usual GNU command line syntax,
+with long options starting with two dashes (`-').  A summary of
+options is included below.
+.TP
+\fB--debug \fR
+Show a little debug info
+.TP
+\fB--skip=n \fR
+Skips the first n cards and acts on the n+1
+.SH "AUTHOR"
+.PP
+This manual page was written by Luigi Gangitano <luigi@debian.org> for
+the Debian system (but may be used by others).  Permission is
+granted to copy, distribute and/or modify this document under
+the terms of the GNU General Public License, Version 2 any 
+later version published by the Free Software Foundation.
+.PP
+On Debian systems, the complete text of the GNU General Public
+License can be found in /usr/share/common-licenses/GPL.
--- radeontool-1.5/radeontool.c.orig	2004-02-11 03:50:27.000000000 +0000
+++ radeontool-1.5/radeontool.c	2008-05-01 11:52:13.000000000 +0100
@@ -21,10 +21,11 @@
 #include <sys/stat.h>
 #include <fcntl.h>
 #include <sys/mman.h>
-#include <asm/page.h>
 
 #include "radeon_reg.h"
 
+#define PAGE_SIZE sysconf(_SC_PAGE_SIZE)
+
 int debug;
 int skip;
 
@@ -83,7 +84,7 @@
 /* with /dev/mem, then I could write this whole program in perl, */
 /* but sadly this is only the size of physical RAM.  If you */
 /* want to be truely bad and poke into device memory you have to mmap() */
-static unsigned char * map_devince_memory(unsigned int base,unsigned int length) 
+static unsigned char * map_device_memory(unsigned int base,unsigned int length) 
 {
     int mem_fd;
     unsigned char *device_mem;
@@ -109,7 +110,7 @@
     );
     if ((long)device_mem < 0) {
         if(debug)
-            fprintf(stderr,"mmap returned %d\n",(int)device_mem);
+            fprintf(stderr,"mmap returned %ld\n",(long)device_mem);
         fatal("mmap error \n");
     }
     return device_mem;
@@ -293,7 +294,8 @@
        if(fgets(line,sizeof(line),fp) == NULL) {  /* if end of file */
           fatal("Radeon hardware not found in lspci output.\n");
        }
-       if(strstr(line,"Radeon") || strstr(line,"ATI Tech")) {  /* if line contains a "radeon" string */
+       if(strstr(line, "VGA") && (strstr(line,"Radeon") || strstr(line,"ATI Tech"))) {
+          /* if line contains a "VGA" (i.e. is a video card) and "radeon" or "ATI Tech" string */
           if(skip-- < 1) {
              break;
           }
@@ -316,7 +318,7 @@
     }
     if(debug)
         printf("Radeon found. Base control address is %x.\n",base);
-    radeon_cntl_mem = map_devince_memory(base,0x2000);
+    radeon_cntl_mem = map_device_memory(base,0x2000);
 }
 
 int main(int argc,char *argv[]) 
@@ -325,14 +327,19 @@
         map_radeon_cntl_mem();
 	usage();
     }
-    if(strcmp(argv[1],"--debug") == 0) {
-        debug=1;
-        argv++; argc--;
-    };
-    if(strcmp(argv[1],"--skip=") == 0) {
-        skip=atoi(argv[1]+7);
-        argv++; argc--;
-    };
+    debug = 0;
+    skip = 0;
+    while (argc >= 2) {
+        if(strcmp(argv[1],"--debug") == 0) {
+            debug=1;
+            argv++; argc--;
+        } else if (strncmp(argv[1],"--skip=", 7) == 0) {
+            skip=atoi(argv[1]+7);
+            argv++; argc--;
+        } else {
+            break;
+        }
+    }
     map_radeon_cntl_mem();
     if(argc == 2) {
         if(strcmp(argv[1],"regs") == 0) {
--- radeontool-1.5/Makefile.orig	2002-06-23 06:28:15.000000000 +0100
+++ radeontool-1.5/Makefile	2008-05-01 11:35:53.000000000 +0100
@@ -1,8 +1,5 @@
-
+CFLAGS=-O2 -Wall
+CC=gcc
 
 radeontool: radeontool.c
-	gcc -Wall -O2 radeontool.c -o radeontool
-
-
-
-
+	$(CC) $(CFLAGS) radeontool.c -o radeontool
